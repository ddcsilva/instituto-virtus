@if (carregando()) {
<div class="loading-container">
  <mat-spinner></mat-spinner>
  <p>Carregando dados do usuário...</p>
</div>
} @else {
<div class="dashboard-container fade-in">
  <!-- Seção de Boas-vindas -->
  <div class="welcome-section">
    <div class="welcome-content">
      <h1>Bem-vindo, {{ nomeUsuario() }}!</h1>
      <p>{{ tipoUsuario() }} - Instituto Virtus</p>
    </div>
  </div>

  <!-- Cards de Resumo -->
  <div class="dashboard-grid">
    @for (card of cardsVisiveis(); track card.title) {
    <mat-card
      class="stat-card hover-lift"
      [routerLink]="card.route"
      [ngClass]="{
               'students': card.title === 'Total de Alunos',
               'classes': card.title === 'Turmas Ativas' || card.title === 'Minhas Turmas',
               'revenue': card.title.includes('Mensalidades') || card.title.includes('R$'),
               'attendance': card.title.includes('Presença') || card.title.includes('Frequência')
             }">
      <mat-card-content>
        <div class="stat-header">
          <div class="stat-icon">
            <mat-icon>{{ card.icon }}</mat-icon>
          </div>
          @if (card.trend) {
          <div class="stat-trend">
            <mat-chip [ngClass]="card.trend > 0 ? 'positive' : 'negative'">
              {{ card.trend > 0 ? '+' : '' }}{{ card.trend }}%
            </mat-chip>
          </div>
          }
        </div>
        <div class="stat-value">{{ card.value }}</div>
        <div class="stat-label">{{ card.title }}</div>
      </mat-card-content>
    </mat-card>
    }
  </div>

  <!-- Ações Rápidas -->
  <h2 class="section-title">Ações Rápidas</h2>
  <div class="actions-grid">
    @for (action of acoesVisiveis(); track action.label; let i = $index) {
    <mat-card class="action-card hover-lift" [routerLink]="action.route">
      <mat-card-content>
        <div
          class="action-icon"
          [ngClass]="{
               'primary': i % 4 === 0,
               'secondary': i % 4 === 1,
               'accent': i % 4 === 2,
               'teal': i % 4 === 3
             }">
          <mat-icon>{{ action.icon }}</mat-icon>
        </div>
        <p class="action-label">{{ action.label }}</p>
      </mat-card-content>
    </mat-card>
    }
  </div>

  <!-- Atividades Recentes -->
  @if (ehAdministrador() || ehCoordenador()) {
  <div class="content-section">
    <div class="section-header">
      <mat-icon>history</mat-icon>
      <h3>Atividades Recentes</h3>
    </div>
    <div class="activity-list">
      @for (activity of atividadesRecentes(); track activity.id; let i = $index) {
      <div class="activity-item">
        <div
          class="activity-icon"
          [ngClass]="{
               'success': i % 3 === 0,
               'info': i % 3 === 1,
               'warning': i % 3 === 2
             }">
          <mat-icon>{{ activity.icon }}</mat-icon>
        </div>
        <div class="activity-content">
          <p>{{ activity.description }}</p>
          <small>{{ activity.timestamp | date : 'dd/MM/yyyy HH:mm' }}</small>
        </div>
      </div>
      } @empty {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <p>Nenhuma atividade recente</p>
      </div>
      }
    </div>
  </div>
  }

  <!-- Portal do Aluno/Responsável -->
  @if (ehAluno() || ehResponsavel()) {
  <div class="portal-grid">
    <div class="portal-card">
      <div class="portal-header">
        <h4>Minhas Turmas</h4>
      </div>
      <div class="portal-content">
        <div class="portal-list">
          @for (turma of minhasTurmas(); track turma.id) {
          <div class="portal-item">
            <strong>{{ turma.nome }}</strong>
            <span>{{ turma.horario }}</span>
          </div>
          } @empty {
          <div class="empty-state">
            <mat-icon>school</mat-icon>
            <p>Nenhuma turma matriculada</p>
          </div>
          }
        </div>
      </div>
      <div class="portal-actions">
        <button mat-raised-button color="primary" routerLink="/portal/turmas">Ver Todas</button>
      </div>
    </div>

    <div class="portal-card">
      <div class="portal-header">
        <h4>Próximos Pagamentos</h4>
      </div>
      <div class="portal-content">
        <div class="portal-list">
          @for (pagamento of proximosPagamentos(); track pagamento.id) {
          <div class="portal-item">
            <strong>{{ pagamento.competencia }}</strong>
            <span [class.warn]="pagamento.vencido">R$ {{ pagamento.valor }}</span>
          </div>
          } @empty {
          <div class="empty-state">
            <mat-icon>account_balance_wallet</mat-icon>
            <p>Nenhum pagamento pendente</p>
          </div>
          }
        </div>
      </div>
      <div class="portal-actions">
        <button mat-raised-button color="primary" routerLink="/portal/financeiro">Ver Todos</button>
      </div>
    </div>
  </div>
  }
</div>
}
