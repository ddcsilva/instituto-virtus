<mat-sidenav-container class="sidenav-container" [autosize]="true">
  <!-- Sidenav Lateral -->
  <mat-sidenav
    #drawer
    class="sidenav"
    [class.sidenav-collapsed]="isCollapsed()"
    [style.width.px]="isCollapsed() ? 72 : 280"
    [attr.role]="isHandset() ? 'dialog' : 'navigation'"
    [mode]="isHandset() ? 'over' : 'side'"
    [opened]="!isHandset()">
    <!-- Header do Sidenav com Logo -->
    <div class="sidenav-header">
      <div class="logo-container">
        <div class="logo-icon">
          <span class="logo-cross">✝</span>
        </div>
        @if (!isCollapsed()) {
        <div class="logo-text">
          <span class="logo-name">Instituto Virtus</span>
          <span class="logo-tagline">Bethesda</span>
        </div>
        }
      </div>
    </div>

    <!-- Menu de Navegação -->
    <nav class="nav-list">
      @for (item of itensVisiveis(); track item.route) {
      <a
        class="nav-item"
        [class.active]="
          router.isActive(item.route, {
            paths: 'exact',
            queryParams: 'ignored',
            fragment: 'ignored',
            matrixParams: 'ignored'
          })
        "
        [routerLink]="item.route"
        [matTooltip]="isCollapsed() ? item.label : ''"
        matTooltipPosition="right"
        (click)="isHandset() && drawer.close()">
        <mat-icon [matBadge]="item.badge" [matBadgeColor]="item.badgeColor || 'primary'" [matBadgeHidden]="!item.badge">
          {{ item.icon }}
        </mat-icon>
        @if (!isCollapsed()) {
        <span class="nav-label">{{ item.label }}</span>
        }
      </a>
      }
    </nav>

    <!-- Footer do Sidenav (apenas desktop) -->
    @if (!isHandset()) {
    <div class="sidenav-footer">
      <button
        mat-icon-button
        (click)="toggleSidenav()"
        [matTooltip]="isCollapsed() ? 'Expandir menu' : 'Recolher menu'">
        <mat-icon>{{ isCollapsed() ? "chevron_right" : "chevron_left" }}</mat-icon>
      </button>
    </div>
    }
  </mat-sidenav>

  <!-- Conteúdo Principal -->
  <mat-sidenav-content [class.nav-collapsed]="isCollapsed()">
    <!-- Toolbar Superior Integrada -->
    <mat-toolbar class="toolbar-integrated">
      <div class="toolbar-left">
        @if (isHandset()) {
        <button type="button" mat-icon-button (click)="drawer.toggle()" class="menu-toggle">
          <mat-icon>menu</mat-icon>
        </button>
        }

        <!-- Saudação e Info Contextual -->
        <div class="greeting-section">
          <h2 class="greeting">{{ saudacao() }}, {{ (usuarioAtual()?.nome?.split(" ") || [])[0] || "Usuário" }}!</h2>
          <span class="date-time">{{ formatDate() }} • {{ formatTime() }}</span>
        </div>
      </div>

      <div class="toolbar-right">
        <!-- Ações Rápidas -->
        <div class="quick-actions">
          @for (action of quickActions; track action.tooltip) {
          <button mat-icon-button [matTooltip]="action.tooltip" (click)="action.action()" class="action-button">
            <mat-icon
              [matBadge]="action.badge"
              matBadgeColor="warn"
              [matBadgeHidden]="!action.badge"
              matBadgeSize="small">
              {{ action.icon }}
            </mat-icon>
          </button>
          }
        </div>

        <!-- Separador Visual -->
        <div class="toolbar-divider"></div>

        <!-- Versão do app (compacta) -->
        <span class="version-chip" matTooltip="Versão do sistema">v1.0.0</span>

        <!-- Menu do Usuário -->
        <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-trigger">
          <div class="user-avatar">
            {{ obterIniciais() }}
          </div>
        </button>

        <!-- Menu Dropdown do Usuário -->
        <mat-menu #userMenu="matMenu" class="user-dropdown-menu">
          <!-- Header do Menu -->
          <div class="menu-header">
            <div class="menu-avatar">{{ obterIniciais() }}</div>
            <div class="menu-user-details">
              <strong>{{ usuarioAtual()?.nome }}</strong>
              <small>{{ usuarioAtual()?.email }}</small>
              <span class="role-badge">{{ userRole() }}</span>
            </div>
          </div>

          <mat-divider></mat-divider>

          <!-- Opções do Menu -->
          <button mat-menu-item (click)="navigateToProfile()">
            <mat-icon>person</mat-icon>
            <span>Meu Perfil</span>
          </button>

          <button mat-menu-item (click)="navigateToSettings()">
            <mat-icon>settings</mat-icon>
            <span>Configurações</span>
          </button>

          <button mat-menu-item (click)="openHelp()">
            <mat-icon>help</mat-icon>
            <span>Central de Ajuda</span>
          </button>

          <mat-divider></mat-divider>

          <button mat-menu-item (click)="logout()" class="logout-option">
            <mat-icon>logout</mat-icon>
            <span>Sair do Sistema</span>
          </button>
        </mat-menu>
      </div>
    </mat-toolbar>

    <!-- Barra de Progresso -->
    @if (carregando()) {
    <mat-progress-bar mode="indeterminate" class="loading-bar" />
    }

    <!-- Conteúdo da Página -->
    <main class="main-content">
      <div class="content-wrapper">
        <router-outlet />
      </div>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
